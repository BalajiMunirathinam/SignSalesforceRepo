/*
	Author : Balaji
	Description : This sample class will query a template by name 'NDA' and Account 'GenePoint'
				  from Salesforce instance and create and successfully send the agreement to the 
				  intended recipient specified in agreement template
*/

global class AgreementLoadFrmTempMasterRecController {

    public static String agreementId='';
    public static String masterRecordId='';
    public static String agreementTemplateId='';
    public static list<Id> agreementIdlst = new list<Id>();
	
    public AgreementLoadFrmTempMasterRecController(){
        loadAgreements();
    }

    public static void loadAgreements(){
		Account  masterAccName = [SELECT Id,Name from Account where Name = 'GenePoint' LIMIT 1];
		echosign_dev1__Agreement_Template__c agreementNDATemplate = [SELECT ID 
										FROM echosign_dev1__Agreement_Template__c 
										WHERE Name = 'NDA'
										LIMIT 1
									 ];
		masterRecordId = masterAccName.Id;
		agreementTemplateId = agreementNDATemplate.Id;
		
		if(masterRecordId !=null && agreementTemplateId!=null)
			agreementId = echosign_dev1.AgreementTemplateService.load(agreementTemplateId, masterRecordId);
        if(agreementId!=null)
			sendAgreement();
    }		
    
  public static void sendAgreement(){
      /* Method 1: Single Agreement */
     //-------------------------------//
     echosign_dev1.EchoSignApiService.sendDocument(agreementId);
      
     
      /* Method 2: Bulk Agreements */
     //-------------------------------//
     /*agreementIdlst.add(agreementId);
      		system.debug('AgmtRecs'+agreementIdlst);
      User u = [SELECT ID,Name,Email FROM User WHERE ID=:UserInfo.getUserId()];
      
      echosign_dev1.EchoSignActionBatch batch = new echosign_dev1.EchoSignActionBatch(agreementIdlst,'Send',null,u); 
      Id syncProcessId = Database.executeBatch(batch, 5);*/
	}
}
